<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fala Alunos - Sistema de Gestão</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Fala Alunos</span>
            </div>
            <div class="admin-user-info">
                <span class="user-indicator">
                    <i class="fas fa-user-shield"></i>
                    Administrador
                </span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-chart-bar"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#organograma" class="nav-link" data-section="organograma">
                        <i class="fas fa-sitemap"></i> Organograma
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#kanban" class="nav-link" data-section="kanban">
                        <i class="fas fa-tasks"></i> Kanban
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#usuarios" class="nav-link" data-section="usuarios">
                        <i class="fas fa-users"></i> Usuários
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#metricas" class="nav-link" data-section="metricas">
                        <i class="fas fa-analytics"></i> Métricas
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#chat" class="nav-link" data-section="chat">
                        <i class="fas fa-comments"></i> Chat
                    </a>
                </li>
            </ul>
            <div class="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="container">
                <h1>Dashboard Principal</h1>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Visão Geral</h3>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-number">45%</span>
                                    <span class="stat-label">Taxa de Conclusão</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">16</span>
                                    <span class="stat-label">Projetos Ativos</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">16</span>
                                    <span class="stat-label">Usuários Online</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Gráfico de Performance</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Atividades Recentes</h3>
                        </div>
                        <div class="card-content">
                            <div class="activity-list">
                                <div class="activity-item">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Novo usuário cadastrado</span>
                                    <small>2 min atrás</small>
                                </div>
                                <div class="activity-item">
                                    <i class="fas fa-check"></i>
                                    <span>Tarefa concluída no Kanban</span>
                                    <small>5 min atrás</small>
                                </div>
                                <div class="activity-item">
                                    <i class="fas fa-edit"></i>
                                    <span>Organograma atualizado</span>
                                    <small>10 min atrás</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Organograma Section -->
        <section id="organograma" class="section">
            <div class="container">
                <h1>Organograma</h1>
                
                <!-- Controles do Organograma -->
                <div class="organograma-controls">
                    <button class="btn btn-primary" onclick="openAddPositionModal()">
                        <i class="fas fa-plus"></i> Adicionar Cargo
                    </button>
                    <button class="btn btn-secondary" onclick="resetOrganogram()">
                        <i class="fas fa-refresh"></i> Resetar Organograma
                    </button>
                    <div class="view-controls">
                        <label>
                            <input type="checkbox" id="showConnectionLines" checked onchange="toggleConnectionLines()">
                            Mostrar Linhas de Conexão
                        </label>
                    </div>
                </div>

                <!-- Container do Organograma -->
                <div class="organograma-container" id="organogramaContainer">
                    <div class="empty-organogram">
                        <i class="fas fa-sitemap"></i>
                        <h3>Organograma Vazio</h3>
                        <p>Comece adicionando o primeiro cargo da sua organização</p>
                        <button class="btn btn-primary" onclick="openAddPositionModal()">
                            <i class="fas fa-plus"></i> Adicionar Primeiro Cargo
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Kanban Section -->
        <section id="kanban" class="section">
            <div class="container">
                <h1>Kanban Board</h1>
                <div class="kanban-board">
                    <div class="kanban-column" data-status="todo">
                        <div class="column-header">
                            <h3>A Fazer</h3>
                            <span class="task-count">3</span>
                        </div>
                        <div class="column-content" id="todo-column">
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority high"></div>
                                <div class="card-header">
                                    <h4>Implementar Dashboard</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Criar interface principal do sistema</p>
                                <div class="card-footer">
                                    <span class="card-date">15/12/2024</span>
                                    <div class="card-avatar">JD</div>
                                </div>
                            </div>
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority medium"></div>
                                <div class="card-header">
                                    <h4>Revisar Documentação</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Atualizar manuais do usuário</p>
                                <div class="card-footer">
                                    <span class="card-date">16/12/2024</span>
                                    <div class="card-avatar">MS</div>
                                </div>
                            </div>
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority low"></div>
                                <div class="card-header">
                                    <h4>Teste de Performance</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Verificar velocidade do sistema</p>
                                <div class="card-footer">
                                    <span class="card-date">17/12/2024</span>
                                    <div class="card-avatar">AB</div>
                                </div>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="addTask('todo')">
                            <i class="fas fa-plus"></i> Adicionar Tarefa
                        </button>
                    </div>

                    <div class="kanban-column" data-status="doing">
                        <div class="column-header">
                            <h3>Em Progresso</h3>
                            <span class="task-count">2</span>
                        </div>
                        <div class="column-content" id="doing-column">
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority high"></div>
                                <div class="card-header">
                                    <h4>Desenvolver API</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Criar endpoints para integração</p>
                                <div class="card-footer">
                                    <span class="card-date">14/12/2024</span>
                                    <div class="card-avatar">LT</div>
                                </div>
                            </div>
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority medium"></div>
                                <div class="card-header">
                                    <h4>Design UI/UX</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Melhorar interface do usuário</p>
                                <div class="card-footer">
                                    <span class="card-date">13/12/2024</span>
                                    <div class="card-avatar">RF</div>
                                </div>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="addTask('doing')">
                            <i class="fas fa-plus"></i> Adicionar Tarefa
                        </button>
                    </div>

                    <div class="kanban-column" data-status="review">
                        <div class="column-header">
                            <h3>Em Revisão</h3>
                            <span class="task-count">1</span>
                        </div>
                        <div class="column-content" id="review-column">
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority medium"></div>
                                <div class="card-header">
                                    <h4>Validar Funcionalidades</h4>
                                    <div class="card-actions">
                                        <button class="btn-action complete" onclick="completeTask(this)" title="Marcar como concluída">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Testar todas as features implementadas</p>
                                <div class="card-footer">
                                    <span class="card-date">12/12/2024</span>
                                    <div class="card-avatar">CM</div>
                                </div>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="addTask('review')">
                            <i class="fas fa-plus"></i> Adicionar Tarefa
                        </button>
                    </div>

                    <div class="kanban-column" data-status="done">
                        <div class="column-header">
                            <h3>Concluído</h3>
                            <span class="task-count">4</span>
                        </div>
                        <div class="column-content" id="done-column">
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority high"></div>
                                <div class="card-header">
                                    <h4>Setup Inicial</h4>
                                    <div class="card-actions">
                                        <button class="btn-action reopen" onclick="reopenTask(this)" title="Reabrir tarefa">
                                            <i class="fas fa-undo"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Configuração do ambiente de desenvolvimento</p>
                                <div class="card-footer">
                                    <span class="card-date">10/12/2024</span>
                                    <div class="card-avatar">LT</div>
                                </div>
                            </div>
                            <div class="kanban-card" draggable="true">
                                <div class="card-priority medium"></div>
                                <div class="card-header">
                                    <h4>Banco de Dados</h4>
                                    <div class="card-actions">
                                        <button class="btn-action reopen" onclick="reopenTask(this)" title="Reabrir tarefa">
                                            <i class="fas fa-undo"></i>
                                        </button>
                                        <button class="btn-action edit" onclick="editTask(this)" title="Editar tarefa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action delete" onclick="deleteTask(this)" title="Excluir tarefa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p>Estrutura e modelagem dos dados</p>
                                <div class="card-footer">
                                    <span class="card-date">11/12/2024</span>
                                    <div class="card-avatar">DB</div>
                                </div>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="addTask('done')">
                            <i class="fas fa-plus"></i> Adicionar Tarefa
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Usuários Section -->
        <section id="usuarios" class="section">
            <div class="container">
                <h1>Gestão de Usuários</h1>
                <div class="users-header">
                    <button class="btn btn-primary" onclick="openUserModal()">
                        <i class="fas fa-user-plus"></i> Adicionar Usuário
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar usuários..." id="userSearch">
                    </div>
                </div>
                
                <div class="users-grid">
                    <div class="user-card">
                        <div class="user-avatar">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="user-info">
                            <h4>Lucas Toledo</h4>
                            <span class="user-role director">Diretor</span>
                            <p>lucas.toledo@falaalunos.com</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn-icon" onclick="editUser(1)">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteUser(1)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="user-card">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <h4>Maria Silva</h4>
                            <span class="user-role coordinator">Coordenadora</span>
                            <p>maria.silva@falaalunos.com</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn-icon" onclick="editUser(2)">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteUser(2)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="user-card">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <h4>João Santos</h4>
                            <span class="user-role teacher">Professor</span>
                            <p>joao.santos@falaalunos.com</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn-icon" onclick="editUser(3)">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteUser(3)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="user-card">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <h4>Ana Costa</h4>
                            <span class="user-role teacher">Professora</span>
                            <p>ana.costa@falaalunos.com</p>
                        </div>
                        <div class="user-actions">
                            <button class="btn-icon" onclick="editUser(4)">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteUser(4)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Métricas Section -->
        <section id="metricas" class="section">
            <div class="container">
                <h1>Métricas e Relatórios</h1>
                <div class="metrics-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Gráfico de Barras - Performance por Período</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Estatísticas Principais</h3>
                        </div>
                        <div class="card-content">
                            <div class="metrics-stats">
                                <div class="metric-item">
                                    <div class="metric-circle">
                                        <span>45%</span>
                                    </div>
                                    <p>Taxa de Conclusão</p>
                                </div>
                                <div class="metric-bars">
                                    <div class="metric-bar">
                                        <span>Projetos Ativos</span>
                                        <div class="bar-container">
                                            <div class="bar" style="width: 80%"></div>
                                        </div>
                                        <span>16</span>
                                    </div>
                                    <div class="metric-bar">
                                        <span>Usuários Online</span>
                                        <div class="bar-container">
                                            <div class="bar" style="width: 60%"></div>
                                        </div>
                                        <span>16</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Gráfico de Linhas - Evolução Temporal</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="lineChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Comparativo por Categoria</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat Section -->
        <section id="chat" class="section">
            <div class="container">
                <h1>Central de Atendimento</h1>
                
                <!-- Chat Header com Estatísticas -->
                <div class="chat-header">
                    <div class="chat-stats">
                        <div class="stat-card">
                            <i class="fas fa-clock"></i>
                            <div>
                                <span class="stat-number">2 min</span>
                                <span class="stat-label">Tempo Médio de Resposta</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <div>
                                <span class="stat-number">3</span>
                                <span class="stat-label">Coordenadores Online</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <span class="stat-number">98%</span>
                                <span class="stat-label">Satisfação</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-actions">
                        <button class="btn btn-primary" onclick="openNewChatModal()">
                            <i class="fas fa-plus"></i> Nova Conversa
                        </button>
                        <button class="btn btn-secondary" onclick="openSuggestionsModal()">
                            <i class="fas fa-lightbulb"></i> Enviar Sugestão
                        </button>
                    </div>
                </div>

                <!-- Dicas de Navegação -->
                <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.9rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;">
                            <span><kbd>Ctrl+↑↓</kbd> Navegar conversas</span>
                            <span><kbd>Ctrl+Home/End</kbd> Início/Fim mensagens</span>
                            <span><kbd>Page ↑↓</kbd> Scroll mensagens</span>
                        </div>
                        <small style="color: #6c757d;">Dicas de navegação</small>
                    </div>
                </div>

                <!-- Chat Container -->
                <div class="chat-container">
                    <!-- Lista de Conversas -->
                    <div class="chat-sidebar">
                        <div class="chat-sidebar-header">
                            <h3>Conversas</h3>
                            <div class="chat-filter">
                                <select id="chatFilter">
                                    <option value="all">Todas</option>
                                    <option value="academic">Acadêmicas</option>
                                    <option value="administrative">Administrativas</option>
                                    <option value="suggestions">Sugestões</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="chat-list" id="chatList">
                            <div class="chat-item active" data-chat-id="1">
                                <div class="chat-avatar">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <div class="chat-info">
                                    <h4>Suporte Acadêmico</h4>
                                    <p>Dúvida sobre matrícula em disciplinas</p>
                                    <small>Agora</small>
                                </div>
                                <div class="chat-status online"></div>
                            </div>
                            
                            <div class="chat-item" data-chat-id="2">
                                <div class="chat-avatar">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="chat-info">
                                    <h4>Processos Administrativos</h4>
                                    <p>Solicitação de histórico escolar</p>
                                    <small>5 min atrás</small>
                                </div>
                                <div class="chat-status online"></div>
                            </div>
                            
                            <div class="chat-item" data-chat-id="3">
                                <div class="chat-avatar">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="chat-info">
                                    <h4>Canal de Sugestões</h4>
                                    <p>Ideias para melhoria do sistema</p>
                                    <small>1 hora atrás</small>
                                </div>
                                <div class="chat-status away"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Área de Chat Principal -->
                    <div class="chat-main">
                        <div class="chat-main-header">
                            <div class="chat-contact-info">
                                <div class="contact-avatar">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <div class="contact-details">
                                    <h4>Suporte Acadêmico</h4>
                                    <span class="contact-status">
                                        <i class="fas fa-circle online"></i> Online - Coord. Maria Silva
                                    </span>
                                </div>
                            </div>
                            <div class="chat-options">
                                <button class="btn-icon" onclick="toggleChatInfo()">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </div>
                        </div>

                        <div class="chat-messages" id="chatMessages">
                            <!-- Contador de mensagens para admin -->
                            <div class="admin-message-counter" id="adminMessageCounter">
                                1 de 1
                            </div>
                            
                            <!-- Indicador de posição no chat -->
                            <div class="admin-position-indicator" id="adminPositionIndicator"></div>
                            
                            <!-- Barra de progresso de scroll -->
                            <div class="admin-scroll-progress" id="adminScrollProgress"></div>
                            
                            <div class="message-date">Hoje</div>
                            
                            <div class="message received">
                                <div class="message-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble">
                                        Olá! Bem-vindo ao suporte acadêmico da UniSync. Como posso ajudá-lo hoje?
                                    </div>
                                    <div class="message-time">14:30</div>
                                </div>
                            </div>

                            <div class="message sent">
                                <div class="message-content">
                                    <div class="message-bubble">
                                        Olá! Tenho dúvidas sobre o processo de matrícula em disciplinas optativas. Poderia me ajudar?
                                    </div>
                                    <div class="message-time">14:32</div>
                                </div>
                            </div>

                            <div class="message received">
                                <div class="message-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble">
                                        Claro! Ficarei feliz em ajudar. As matrículas em disciplinas optativas seguem algumas etapas específicas. Primeiro, você precisa verificar os pré-requisitos...
                                    </div>
                                    <div class="message-time">14:33</div>
                                </div>
                            </div>

                            <div class="message received typing">
                                <div class="message-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble">
                                        <div class="typing-indicator">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input-container">
                            <div class="quick-responses" id="quickResponses">
                                <button class="quick-response-btn" onclick="insertQuickResponse('Preciso de ajuda com matrícula')">
                                    Matrícula
                                </button>
                                <button class="quick-response-btn" onclick="insertQuickResponse('Como solicito meu histórico?')">
                                    Histórico
                                </button>
                                <button class="quick-response-btn" onclick="insertQuickResponse('Tenho dúvidas sobre prazos')">
                                    Prazos
                                </button>
                                <button class="quick-response-btn" onclick="insertQuickResponse('Preciso falar sobre financeiro')">
                                    Financeiro
                                </button>
                            </div>
                            
                            <div class="chat-input">
                                <button class="btn-icon" onclick="toggleQuickResponses()">
                                    <i class="fas fa-bolt"></i>
                                </button>
                                <input type="text" id="messageInput" placeholder="Digite sua mensagem..." onkeypress="handleEnterKey(event)">
                                <button class="btn-icon" onclick="attachFile()">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="btn-icon" onclick="sendMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Botão de scroll para baixo específico para admin -->
                        <button class="admin-scroll-bottom" id="adminScrollButton" onclick="scrollToBottom()" title="Ir para última mensagem">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>

                    <!-- Painel de Informações -->
                    <div class="chat-info-panel" id="chatInfoPanel">
                        <div class="info-panel-header">
                            <h3>Informações do Atendimento</h3>
                            <button class="btn-icon" onclick="toggleChatInfo()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="info-panel-content">
                            <div class="info-section">
                                <h4>Categoria</h4>
                                <span class="info-tag academic">Suporte Acadêmico</span>
                            </div>
                            
                            <div class="info-section">
                                <h4>Coordenador Responsável</h4>
                                <div class="coordinator-info">
                                    <div class="coordinator-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div>
                                        <strong>Maria Silva</strong>
                                        <p>Coordenadora Acadêmica</p>
                                        <span class="status-indicator online">Online</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="info-section">
                                <h4>Horário de Atendimento</h4>
                                <p>Segunda a Sexta: 8h às 18h<br>
                                Sábado: 8h às 12h</p>
                            </div>
                            
                            <div class="info-section">
                                <h4>Ações Rápidas</h4>
                                <div class="quick-actions">
                                    <button class="quick-action-btn" onclick="rateChat()">
                                        <i class="fas fa-star"></i> Avaliar Atendimento
                                    </button>
                                    <button class="quick-action-btn" onclick="requestCallback()">
                                        <i class="fas fa-phone"></i> Solicitar Retorno
                                    </button>
                                    <button class="quick-action-btn" onclick="escalateChat()">
                                        <i class="fas fa-arrow-up"></i> Falar com Supervisor
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Dicas de navegação específicas para admin -->
                <div class="admin-navigation-hint" id="adminNavigationHint">
                    Pressione uma tecla para navegar...
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para adicionar/editar usuário -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Adicionar Usuário</h3>
                <span class="close" onclick="closeUserModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label for="userName">Nome:</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email:</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="userRole">Cargo:</label>
                        <select id="userRole" required>
                            <option value="">Selecione um cargo</option>
                            <option value="director">Diretor</option>
                            <option value="coordinator">Coordenador</option>
                            <option value="teacher">Professor</option>
                            <option value="student">Aluno</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar tarefa -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Nova Tarefa</h3>
                <span class="close" onclick="closeTaskModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Título:</label>
                        <input type="text" id="taskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Descrição:</label>
                        <textarea id="taskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Prioridade:</label>
                        <select id="taskPriority" required>
                            <option value="low">Baixa</option>
                            <option value="medium">Média</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskDate">Data:</label>
                        <input type="date" id="taskDate" required>
                    </div>
                    <div class="form-group">
                        <label for="taskAssignee">Responsável:</label>
                        <input type="text" id="taskAssignee" placeholder="Iniciais" maxlength="2" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Adicionar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Conversa -->
    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Iniciar Nova Conversa</h3>
                <span class="close" onclick="closeNewChatModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="newChatForm">
                    <div class="form-group">
                        <label for="chatCategory">Categoria do Atendimento:</label>
                        <select id="chatCategory" required>
                            <option value="">Selecione uma categoria</option>
                            <option value="academic">Suporte Acadêmico</option>
                            <option value="administrative">Processos Administrativos</option>
                            <option value="financial">Questões Financeiras</option>
                            <option value="technical">Suporte Técnico</option>
                            <option value="general">Informações Gerais</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="chatSubject">Assunto:</label>
                        <input type="text" id="chatSubject" placeholder="Descreva brevemente sua dúvida" required>
                    </div>
                    <div class="form-group">
                        <label for="chatMessage">Mensagem Inicial:</label>
                        <textarea id="chatMessage" rows="4" placeholder="Descreva sua dúvida ou solicitação em detalhes..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="chatPriority">Prioridade:</label>
                        <select id="chatPriority" required>
                            <option value="low">Baixa - Não é urgente</option>
                            <option value="medium" selected>Média - Preciso de resposta em algumas horas</option>
                            <option value="high">Alta - É urgente</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeNewChatModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Iniciar Conversa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Sugestões -->
    <div id="suggestionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Enviar Sugestão</h3>
                <span class="close" onclick="closeSuggestionsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="suggestionsForm">
                    <div class="form-group">
                        <label for="suggestionType">Tipo de Sugestão:</label>
                        <select id="suggestionType" required>
                            <option value="">Selecione o tipo</option>
                            <option value="system">Melhoria no Sistema</option>
                            <option value="process">Melhoria em Processos</option>
                            <option value="service">Melhoria no Atendimento</option>
                            <option value="feature">Nova Funcionalidade</option>
                            <option value="other">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="suggestionTitle">Título da Sugestão:</label>
                        <input type="text" id="suggestionTitle" placeholder="Resuma sua sugestão em poucas palavras" required>
                    </div>
                    <div class="form-group">
                        <label for="suggestionDescription">Descrição Detalhada:</label>
                        <textarea id="suggestionDescription" rows="5" placeholder="Descreva sua sugestão em detalhes. Como isso pode melhorar a experiência dos alunos?" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="suggestionBenefit">Benefício Esperado:</label>
                        <textarea id="suggestionBenefit" rows="3" placeholder="Que benefícios essa sugestão traria para os alunos e a instituição?"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeSuggestionsModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Enviar Sugestão</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Avaliação -->
    <div id="ratingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Avaliar Atendimento</h3>
                <span class="close" onclick="closeRatingModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="ratingForm">
                    <div class="form-group">
                        <label>Como você avalia o atendimento recebido?</label>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-rating="1"></i>
                            <i class="fas fa-star" data-rating="2"></i>
                            <i class="fas fa-star" data-rating="3"></i>
                            <i class="fas fa-star" data-rating="4"></i>
                            <i class="fas fa-star" data-rating="5"></i>
                        </div>
                        <input type="hidden" id="ratingValue" required>
                    </div>
                    <div class="form-group">
                        <label for="ratingComment">Comentário (opcional):</label>
                        <textarea id="ratingComment" rows="3" placeholder="Conte-nos mais sobre sua experiência..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeRatingModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Enviar Avaliação</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Tarefa -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Tarefa</h3>
                <span class="close" onclick="closeEditTaskModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editTaskForm">
                    <div class="form-group">
                        <label for="editTaskTitle">Título:</label>
                        <input type="text" id="editTaskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editTaskDescription">Descrição:</label>
                        <textarea id="editTaskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editTaskPriority">Prioridade:</label>
                        <select id="editTaskPriority" required>
                            <option value="low">Baixa</option>
                            <option value="medium">Média</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskDate">Data:</label>
                        <input type="date" id="editTaskDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editTaskAssignee">Responsável:</label>
                        <input type="text" id="editTaskAssignee" placeholder="Iniciais" maxlength="2" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditTaskModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar/Editar Posição do Organograma -->
    <div id="positionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="positionModalTitle">Adicionar Cargo</h3>
                <span class="close" onclick="closePositionModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="positionForm">
                    <div class="form-group">
                        <label for="positionName">Nome da Pessoa:</label>
                        <input type="text" id="positionName" required placeholder="Ex: João Silva">
                    </div>
                    <div class="form-group">
                        <label for="positionTitle">Cargo/Título:</label>
                        <input type="text" id="positionTitle" required placeholder="Ex: Diretor, Coordenador, Professor">
                    </div>
                    <div class="form-group">
                        <label for="positionDepartment">Departamento/Setor:</label>
                        <input type="text" id="positionDepartment" placeholder="Ex: Administrativo, Acadêmico">
                    </div>
                    <div class="form-group">
                        <label for="positionEmail">Email:</label>
                        <input type="email" id="positionEmail" placeholder="email@exemplo.com">
                    </div>
                    <div class="form-group">
                        <label for="positionPhone">Telefone:</label>
                        <input type="tel" id="positionPhone" placeholder="(11) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label for="positionSuperior">Cargo Superior:</label>
                        <select id="positionSuperior">
                            <option value="">Nenhum (Cargo mais alto)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="positionLevel">Nível Hierárquico:</label>
                        <select id="positionLevel" required>
                            <option value="executive">Executivo</option>
                            <option value="management">Gerência</option>
                            <option value="coordination">Coordenação</option>
                            <option value="operation">Operacional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="positionIcon">Ícone:</label>
                        <select id="positionIcon">
                            <option value="fa-user-tie">👔 Executivo</option>
                            <option value="fa-user-graduate">🎓 Acadêmico</option>
                            <option value="fa-user-cog">⚙️ Administrativo</option>
                            <option value="fa-user">👤 Geral</option>
                            <option value="fa-chalkboard-teacher">👨‍🏫 Professor</option>
                            <option value="fa-user-shield">🛡️ Segurança</option>
                            <option value="fa-user-md">👨‍⚕️ Saúde</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closePositionModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Cargo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes da Posição -->
    <div id="positionDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalhes do Cargo</h3>
                <span class="close" onclick="closePositionDetailsModal()">&times;</span>
            </div>
            <div class="modal-body" id="positionDetailsContent">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Script do Chat Manager (deve vir antes do script principal) -->
    <script src="shared-chat.js"></script>
    
    <script>
    // Variáveis globais
    let currentSection = 'dashboard';
    let adminChatInitialized = false;

    // ========== INICIALIZAÇÃO PRINCIPAL ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Iniciando sistema administrativo...');
        
        // Verificar autenticação
        if (!validateAdminAuth()) return;

        // Inicializar componentes básicos
        initializeBasicComponents();
        
        // Inicializar chat administrativo
        initializeAdminChatSystem();
        
        console.log('✅ Sistema administrativo inicializado com sucesso');
    });

    // Validar autenticação administrativa
    function validateAdminAuth() {
        const userProfile = sessionStorage.getItem('userProfile');
        const adminCredentials = sessionStorage.getItem('adminCredentials');
        
        if (userProfile !== 'admin' || adminCredentials !== 'validated') {
            sessionStorage.removeItem('userProfile');
            sessionStorage.removeItem('adminCredentials');
            sessionStorage.removeItem('loginTime');
            window.location.href = 'login.html';
            return false;
        }
        return true;
    }

    // Inicializar componentes básicos
    function initializeBasicComponents() {
        initializeNavigation();
        initializeCharts();
        initializeDragAndDrop();
        initializeSearch();
        initializeModals();
        updateTaskCounts();
        setupNewChatForm();
    }

    // ========== SISTEMA DE CHAT ADMINISTRATIVO ==========
    function initializeAdminChatSystem() {
        if (adminChatInitialized) {
            console.log('⚠️ Chat administrativo já foi inicializado');
            return;
        }

        console.log('📱 Inicializando sistema de chat administrativo...');
        
        // Aguardar ChatManager estar disponível
        const checkChatManager = setInterval(() => {
            if (window.ChatManager) {
                clearInterval(checkChatManager);
                
                // Inicializar o ChatManager
                window.chatManager = new ChatManager('admin', 'Administrador');
                
                // Conectar ao servidor
                window.chatManager.connect();
                
                // Configurar listeners
                window.chatManager.onNewMessage((message) => {
                    console.log('Nova mensagem recebida no admin:', message);
                    addMessageToInterface(message);
                });
                
                console.log('✅ Chat Manager inicializado para administrador');
                
                // Aguardar conexão
                const waitForConnection = setInterval(() => {
                    if (window.chatManager && window.chatManager.isOnline()) {
                        clearInterval(waitForConnection);
                        console.log('🔄 Chat Manager conectado, configurando admin...');
                        
                        // Carregar chats após conexão
                        setTimeout(() => {
                            loadAdminChats();
                            setupChatNavigation();
                        }, 1000);
                    }
                }, 500);
                
                adminChatInitialized = true;
            }
        }, 100);
    }

    // Configurar navegação do chat
    function setupChatNavigation() {
        // Listener para navegação entre chats
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
            if (currentSection !== 'chat') return;
            if (!window.chatManager) return;
            
            switch(event.key) {
                case 'ArrowUp':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        navigateToAdjacentChat('previous');
                    }
                    break;
                case 'ArrowDown':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        navigateToAdjacentChat('next');
                    }
                    break;
                case 'Home':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        scrollToMessage('first');
                    }
                    break;
                case 'End':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        scrollToMessage('last');
                    }
                    break;
                case 'PageUp':
                    event.preventDefault();
                    smoothScrollMessages('up');
                    break;
                case 'PageDown':
                    event.preventDefault();
                    smoothScrollMessages('down');
                    break;
            }
        });

        // Listener para clique na seção de chat
        const chatNavLink = document.querySelector('[data-section="chat"]');
        if (chatNavLink) {
            chatNavLink.addEventListener('click', function() {
                setTimeout(() => {
                    console.log('🔄 Seção de chat acessada, recarregando chats...');
                    loadAdminChats();
                }, 100);
            });
        }
    }

    // ========== FUNÇÕES DE CHAT ==========
    
    // Carregar chats administrativos
    async function loadAdminChats() {
        if (!window.chatManager) {
            console.log('⚠️ Chat Manager não disponível ainda');
            return;
        }

        try {
            console.log('📊 Carregando chats administrativos...');
            const chats = await window.chatManager.loadChats();
            console.log('Chats carregados:', chats);
            
            updateChatList(chats);
            
        } catch (error) {
            console.error('❌ Erro ao carregar chats:', error);
        }
    }

    // Configurar formulário de novo chat
    function setupNewChatForm() {
        const newChatForm = document.getElementById('newChatForm');
        if (newChatForm) {
            newChatForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!window.chatManager) {
                    alert('Sistema de chat não está conectado');
                    return;
                }

                const chatData = {
                    title: document.getElementById('chatSubject').value,
                    category: document.getElementById('chatCategory').value,
                    priority: document.getElementById('chatPriority').value,
                    description: document.getElementById('chatMessage').value
                };

                try {
                    const newChat = await window.chatManager.createChat(chatData);
                    if (newChat) {
                        closeNewChatModal();
                        showAdminNotification('Chat criado com sucesso!', 'success');
                        await loadAdminChats();
                    }
                } catch (error) {
                    console.error('Erro ao criar chat:', error);
                    alert('Erro ao criar chat. Tente novamente.');
                }
            });
        }
    }

    // Enviar mensagem
    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        if (!messageInput || !window.chatManager) return;
        
        const content = messageInput.value.trim();
        if (!content) return;
        
        const success = window.chatManager.sendMessage(content);
        
        if (success) {
            messageInput.value = '';
            showAdminNotification('Mensagem enviada!', 'success');
        } else {
            showAdminNotification('Erro ao enviar mensagem', 'error');
        }
    }
    
    // Função para lidar com Enter no input
    function handleEnterKey(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendMessage();
        }
    }

    // Gerenciar modais de chat
    function openNewChatModal() {
        document.getElementById('newChatModal').style.display = 'block';
    }

    function closeNewChatModal() {
        document.getElementById('newChatModal').style.display = 'none';
        document.getElementById('newChatForm').reset();
    }

    // Função para mostrar notificação no admin
    function showAdminNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `admin-notification ${type}`;
        notification.textContent = message;
        
        // Estilos inline para a notificação
        Object.assign(notification.style, {
            position: 'fixed',
            top: '20px',
            right: '20px',
            background: type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff',
            color: 'white',
            padding: '12px 20px',
            borderRadius: '6px',
            fontWeight: '500',
            zIndex: '10000',
            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
            transition: 'all 0.3s ease',
            transform: 'translateX(100%)',
            opacity: '0'
        });
        
        document.body.appendChild(notification);
        
        // Animação de entrada
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
            notification.style.opacity = '1';
        }, 100);
        
        // Remover após 3 segundos
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // Atualizar lista de chats na interface
    function updateChatList(chats) {
        const chatList = document.getElementById('chatList');
        if (!chatList) return;

        // Remover apenas chats dinâmicos existentes (manter os estáticos)
        const dynamicChats = chatList.querySelectorAll('.chat-item[data-dynamic="true"]');
        dynamicChats.forEach(chat => chat.remove());
        
        // Adicionar chats dinâmicos
        chats.forEach(chat => {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.setAttribute('data-chat-id', chat.id);
            chatItem.setAttribute('data-dynamic', 'true');
            
            const priorityIcon = chat.priority === 'high' ? '🔴' : chat.priority === 'medium' ? '🟡' : '🟢';
            const categoryIcon = getCategoryIcon(chat.category);
            
            chatItem.innerHTML = `
                <div class="chat-avatar">
                    <i class="fas ${categoryIcon}"></i>
                </div>
                <div class="chat-info">
                    <h4>${chat.title} ${priorityIcon}</h4>
                    <p>${chat.description || 'Sem descrição'}</p>
                    <small>${formatTimeAgo(chat.createdAt)} - por ${chat.createdBy}</small>
                </div>
                <div class="chat-status online"></div>
                <div class="chat-actions" style="position: absolute; top: 10px; right: 10px;">
                    <button onclick="deleteChatConfirm(${chat.id}, '${chat.title}')" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 6px; font-size: 10px; cursor: pointer;" title="Excluir chat">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            // Adicionar estilo de posição relativa
            chatItem.style.position = 'relative';
            
            chatItem.addEventListener('click', (e) => {
                // Prevenir clique se clicar no botão de exclusão
                if (e.target.closest('.chat-actions')) return;
                
                // Remover active de outros chats
                chatList.querySelectorAll('.chat-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Adicionar active ao chat clicado
                chatItem.classList.add('active');
                
                // Abrir chat
                openDynamicChat(chat);
            });
            
            chatList.appendChild(chatItem);
        });
        
        console.log(`${chats.length} chats dinâmicos adicionados à lista`);
    }

    // Obter ícone da categoria
    function getCategoryIcon(category) {
        const icons = {
            academic: 'fa-graduation-cap',
            administrative: 'fa-file-alt',
            financial: 'fa-dollar-sign',
            technical: 'fa-cog',
            general: 'fa-comments'
        };
        return icons[category] || 'fa-comments';
    }

    // Formatar tempo relativo
    function formatTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffInMinutes = Math.floor((now - date) / (1000 * 60));
        
        if (diffInMinutes < 1) return 'Agora';
        if (diffInMinutes < 60) return `${diffInMinutes} min atrás`;
        if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)} horas atrás`;
        return `${Math.floor(diffInMinutes / 1440)} dias atrás`;
    }

    // Abrir chat dinâmico
    function openDynamicChat(chat) {
        console.log('Abrindo chat:', chat);
        
        // Atualizar header do chat
        const contactInfo = document.querySelector('.chat-contact-info');
        if (contactInfo) {
            contactInfo.innerHTML = `
                <div class="contact-avatar">
                    <i class="fas ${getCategoryIcon(chat.category)}"></i>
                </div>
                <div class="contact-details">
                    <h4>${chat.title}</h4>
                    <span class="contact-status">
                        <i class="fas fa-circle online"></i> Chat criado por ${chat.createdBy} - ${chat.priority} prioridade
                    </span>
                </div>
            `;
        }
        
        // Limpar mensagens e carregar as específicas do chat
        const messagesContainer = document.getElementById('chatMessages');
        if (messagesContainer) {
            messagesContainer.innerHTML = `
                <div class="message-date">Chat: ${chat.title}</div>
                <div class="message received">
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            ${chat.description || 'Chat iniciado'}
                        </div>
                        <div class="message-time">${formatTimeAgo(chat.createdAt)}</div>
                    </div>
                </div>
            `;
        }
        
        // Atualizar categoria atual do chat manager
        if (window.chatManager) {
            window.chatManager.setCurrentCategory(chat.category);
        }
    }

    // Carregar chats quando a página carrega
    window.addEventListener('load', loadAdminChats);

    // Listener para novos chats criados
    window.addEventListener('newChatCreated', function(event) {
        const chat = event.detail;
        console.log('Novo chat detectado no admin:', chat);
        loadAdminChats();
    });

    // Listener para quando a seção de chat for acessada
    document.addEventListener('DOMContentLoaded', function() {
        const chatNavLink = document.querySelector('[data-section="chat"]');
        if (chatNavLink) {
            chatNavLink.addEventListener('click', function() {
                setTimeout(() => {
                    loadAdminChats();
                }, 100);
            });
        }
    });

    // Função para confirmar exclusão de chat
    function deleteChatConfirm(chatId, chatTitle) {
        if (confirm(`Tem certeza que deseja excluir o chat "${chatTitle}"?\n\nEsta ação não pode ser desfeita e afetará todos os usuários.`)) {
            deleteAdminChat(chatId);
        }
    }

    // Função para excluir chat (admin)
    async function deleteAdminChat(chatId) {
        if (!window.chatManager) {
            alert('Sistema de chat não está conectado');
            return;
        }

        try {
            const deleted = await window.chatManager.deleteChat(chatId);
            if (deleted) {
                showAdminNotification('Chat excluído com sucesso!');
                
                // Recarregar lista de chats
                await loadAdminChats();
                
                // Se o chat excluído estava selecionado, voltar para o chat padrão
                const activeChat = document.querySelector('.chat-item[data-dynamic="true"].active');
                if (!activeChat) {
                    // Selecionar o primeiro chat estático
                    const firstStaticChat = document.querySelector('.chat-item:not([data-dynamic])');
                    if (firstStaticChat) {
                        firstStaticChat.click();
                    }
                }
            } else {
                alert('Erro ao excluir chat. Tente novamente.');
            }
        } catch (error) {
            console.error('Erro ao excluir chat:', error);
            alert('Erro ao excluir chat. Tente novamente.');
        }
    }

    // ========== NAVEGAÇÃO E CONTROLES ESPECÍFICOS PARA ADMIN ==========
    
    // Adicionar listeners de navegação específicos para admin
    document.addEventListener('keydown', function(event) {
        // Verificar se não está digitando em um input
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
        
        // Verificar se está na seção de chat
        if (currentSection !== 'chat') return;
        
        if (!window.chatManager) return;
        
        switch(event.key) {
            case 'ArrowUp':
                if (event.ctrlKey) {
                    // Ctrl + Up: Navegar para chat anterior
                    event.preventDefault();
                    navigateToAdjacentChat('previous');
                }
                break;
                
            case 'ArrowDown':
                if (event.ctrlKey) {
                    // Ctrl + Down: Navegar para próximo chat
                    event.preventDefault();
                    navigateToAdjacentChat('next');
                }
                break;
                
            case 'Home':
                if (event.ctrlKey) {
                    // Ctrl + Home: Ir para primeira mensagem
                    event.preventDefault();
                    scrollToMessage('first');
                }
                break;
                
            case 'End':
                if (event.ctrlKey) {
                    // Ctrl + End: Ir para última mensagem
                    event.preventDefault();
                    scrollToMessage('last');
                }
                break;
                
            case 'PageUp':
                // Page Up: Scroll mensagens para cima
                event.preventDefault();
                smoothScrollMessages('up');
                break;
                
            case 'PageDown':
                // Page Down: Scroll mensagens para baixo
                event.preventDefault();
                smoothScrollMessages('down');
                break;
        }
    });

    // Navegar entre chats adjacentes
    function navigateToAdjacentChat(direction) {
        const chatList = document.getElementById('chatList');
        if (!chatList) return;
        
        const chatItems = chatList.querySelectorAll('.chat-item');
        const activeChat = chatList.querySelector('.chat-item.active');
        
        if (!activeChat || chatItems.length === 0) return;
        
        let targetIndex = Array.from(chatItems).indexOf(activeChat);
        
        if (direction === 'previous') {
            targetIndex = targetIndex > 0 ? targetIndex - 1 : chatItems.length - 1;
        } else {
            targetIndex = targetIndex < chatItems.length - 1 ? targetIndex + 1 : 0;
        }
        
        const targetChat = chatItems[targetIndex];
        if (targetChat) {
            targetChat.click();
            targetChat.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Feedback visual
            showAdminNotification(`Navegando para: ${targetChat.querySelector('h4').textContent}`);
        }
    }

    // Scroll suave nas mensagens
    function smoothScrollMessages(direction) {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        const scrollAmount = messagesContainer.clientHeight * 0.7; // 70% da altura visível
        const currentScroll = messagesContainer.scrollTop;
        
        let targetScroll;
        if (direction === 'up') {
            targetScroll = Math.max(0, currentScroll - scrollAmount);
        } else {
            const maxScroll = messagesContainer.scrollHeight - messagesContainer.clientHeight;
            targetScroll = Math.min(maxScroll, currentScroll + scrollAmount);
        }
        
        messagesContainer.scrollTo({
            top: targetScroll,
            behavior: 'smooth'
        });
    }

    // Scroll para mensagem específica
    function scrollToMessage(position) {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        if (position === 'first') {
            messagesContainer.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            showAdminNotification('Primeira mensagem');
        } else if (position === 'last') {
            messagesContainer.scrollTo({
                top: messagesContainer.scrollHeight,
                behavior: 'smooth'
            });
            showAdminNotification('Última mensagem');
        }
    }

    // Atualizar função de mudança de seção para detectar quando está no chat
    function switchSection(sectionName) {
        // Esconder todas as seções
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Mostrar seção selecionada
        const targetSection = document.getElementById(sectionName);
        if (targetSection) {
            targetSection.classList.add('active');
            currentSection = sectionName;
            
            // Se for a seção de chat, carregar chats administrativos
            if (sectionName === 'chat') {
                setTimeout(() => {
                    loadAdminChats();
                    if (window.showAdminNotification) {
                        showAdminNotification('Seção de chat carregada - Use Ctrl+↑↓ para navegar');
                    }
                }, 100);
            }
        }
        
        // Atualizar navegação
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        const activeNavLink = document.querySelector(`[data-section="${sectionName}"]`);
        if (activeNavLink) {
            activeNavLink.classList.add('active');
        }
        
        console.log(`Seção alterada para: ${sectionName}`);
    }

    // ========== FUNÇÕES ESPECÍFICAS PARA ELEMENTOS VISUAIS DO ADMIN ==========
    
    // Controlar botão de scroll para baixo
    function initializeAdminScrollButton() {
        const messagesContainer = document.getElementById('chatMessages');
        const scrollButton = document.getElementById('adminScrollButton');
        
        if (!messagesContainer || !scrollButton) return;
        
        messagesContainer.addEventListener('scroll', function() {
            const isAtBottom = messagesContainer.scrollTop + messagesContainer.clientHeight >= messagesContainer.scrollHeight - 10;
            
            if (isAtBottom) {
                scrollButton.classList.remove('visible');
            } else {
                scrollButton.classList.add('visible');
            }
            
            // Atualizar barra de progresso
            updateScrollProgress();
            
            // Atualizar contador de mensagens
            updateMessageCounter();
        });
    }
    
    // Scroll para o final
    function scrollToBottom() {
        const messagesContainer = document.getElementById('chatMessages');
        if (messagesContainer) {
            messagesContainer.scrollTo({
                top: messagesContainer.scrollHeight,
                behavior: 'smooth'
            });
            showAdminNotification('Última mensagem');
        }
    }
    
    // Atualizar barra de progresso de scroll
    function updateScrollProgress() {
        const messagesContainer = document.getElementById('chatMessages');
        const progressBar = document.getElementById('adminScrollProgress');
        
        if (!messagesContainer || !progressBar) return;
        
        const scrollPercentage = (messagesContainer.scrollTop / (messagesContainer.scrollHeight - messagesContainer.clientHeight)) * 100;
        progressBar.style.height = Math.min(scrollPercentage, 100) + '%';
    }
    
    // Atualizar contador de mensagens visíveis
    function updateMessageCounter() {
        const messagesContainer = document.getElementById('chatMessages');
        const counter = document.getElementById('adminMessageCounter');
        
        if (!messagesContainer || !counter) return;
        
        const messages = messagesContainer.querySelectorAll('.message:not(.typing)');
        const visibleMessages = Array.from(messages).filter(msg => {
            const rect = msg.getBoundingClientRect();
            const containerRect = messagesContainer.getBoundingClientRect();
            return rect.top >= containerRect.top && rect.bottom <= containerRect.bottom;
        });
        
        if (messages.length > 0) {
            counter.textContent = `${visibleMessages.length} de ${messages.length}`;
            counter.classList.add('visible');
        } else {
            counter.classList.remove('visible');
        }
    }
    
    // Mostrar dica de navegação temporariamente
    function showNavigationHint(text) {
        const hint = document.getElementById('adminNavigationHint');
        if (!hint) return;
        
        hint.textContent = text;
        hint.classList.add('visible');
        
        setTimeout(() => {
            hint.classList.remove('visible');
        }, 2000);
    }
    
    // Destacar mensagem específica
    function highlightMessage(messageElement) {
        // Remover destaque anterior
        document.querySelectorAll('.message.admin-highlight').forEach(msg => {
            msg.classList.remove('admin-highlight');
        });
        
        // Adicionar destaque à nova mensagem
        if (messageElement) {
            messageElement.classList.add('admin-highlight');
            messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
    
    // Inicializar elementos visuais quando o chat for carregado
    function initializeAdminChatElements() {
        initializeAdminScrollButton();
        updateScrollProgress();
        updateMessageCounter();
        
        // Mostrar dica inicial
        setTimeout(() => {
            showNavigationHint('Use Ctrl+↑↓ para navegar entre chats | Page ↑↓ para rolar mensagens');
        }, 1000);
    }
    
    // Função melhorada para adicionar mensagem à interface
    function addMessageToInterface(messageData) {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${messageData.senderType === 'admin' ? 'sent' : 'received'}`;
        
        if (messageData.id) {
            messageDiv.setAttribute('data-message-id', messageData.id);
        }
        
        const time = new Date(messageData.timestamp).toLocaleTimeString('pt-BR', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        if (messageData.senderType === 'admin') {
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">
                        ${messageData.content}
                    </div>
                    <div class="message-time">${time}</div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        ${messageData.content}
                    </div>
                    <div class="message-time">${time}</div>
                </div>
            `;
        }
        
        messagesContainer.appendChild(messageDiv);
        
        // Auto-scroll inteligente para admin
        const scrollButton = document.getElementById('adminScrollButton');
        const isAtBottom = !scrollButton || !scrollButton.classList.contains('visible');
        
        if (isAtBottom) {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                updateScrollProgress();
                updateMessageCounter();
            }, 100);
        }
        
        // Destacar nova mensagem brevemente
        setTimeout(() => {
            highlightMessage(messageDiv);
        }, 200);
    }
    
    // Atualizar as funções existentes para usar os novos elementos visuais
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar elementos quando a seção de chat for acessada
        const chatNavLink = document.querySelector('[data-section="chat"]');
        if (chatNavLink) {
            chatNavLink.addEventListener('click', function() {
                setTimeout(() => {
                    initializeAdminChatElements();
                }, 500);
            });
        }
    });

    // ========== FUNÇÕES DE NAVEGAÇÃO ==========
    
    // Função principal para trocar de seção
    function switchSection(sectionName) {
        // Esconder todas as seções
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Mostrar seção selecionada
        const targetSection = document.getElementById(sectionName);
        if (targetSection) {
            targetSection.classList.add('active');
            currentSection = sectionName;
            
            // Se for a seção de chat, carregar chats administrativos
            if (sectionName === 'chat') {
                setTimeout(() => {
                    loadAdminChats();
                    if (window.showAdminNotification) {
                        showAdminNotification('Seção de chat carregada - Use Ctrl+↑↓ para navegar');
                    }
                }, 100);
            }
        }
        
        // Atualizar navegação
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        const activeNavLink = document.querySelector(`[data-section="${sectionName}"]`);
        if (activeNavLink) {
            activeNavLink.classList.add('active');
        }
        
        console.log(`Seção alterada para: ${sectionName}`);
    }
    
    // Função para inicializar navegação
    function initializeNavigation() {
        console.log('Inicializando navegação...');
        
        // Configurar links de navegação
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const section = this.getAttribute('data-section');
                console.log(`Clique detectado na seção: ${section}`);
                if (section) {
                    switchSection(section);
                }
            });
        });
        
        // Configurar navegação mobile
        const navToggle = document.querySelector('.nav-toggle');
        const navMenu = document.querySelector('.nav-menu');
        
        if (navToggle && navMenu) {
            navToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
        }
        
        console.log('✅ Navegação inicializada com sucesso');
    }
    
    // Função para inicializar gráficos
    function initializeCharts() {
        // Performance Chart
        const performanceCtx = document.getElementById('performanceChart');
        if (performanceCtx) {
            new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Performance',
                        data: [65, 59, 80, 81, 56, 85],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Bar Chart
        const barCtx = document.getElementById('barChart');
        if (barCtx) {
            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Vendas',
                        data: [45, 60, 75, 90],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Line Chart
        const lineCtx = document.getElementById('lineChart');
        if (lineCtx) {
            new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Evolução',
                        data: [30, 45, 60, 70, 65, 80],
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Comparison Chart
        const comparisonCtx = document.getElementById('comparisonChart');
        if (comparisonCtx) {
            new Chart(comparisonCtx, {
                type: 'doughnut',
                data: {
                    labels: ['A', 'B', 'C', 'D'],
                    datasets: [{
                        data: [35, 25, 25, 15],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
    }
    
    // Função para inicializar drag and drop
    function initializeDragAndDrop() {
        const cards = document.querySelectorAll('.kanban-card');
        const columns = document.querySelectorAll('.column-content');
        
        cards.forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
        });
        
        columns.forEach(column => {
            column.addEventListener('dragover', handleDragOver);
            column.addEventListener('drop', handleDrop);
        });
    }
    
    function handleDragStart(e) {
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.outerHTML);
    }
    
    function handleDragEnd(e) {
        this.classList.remove('dragging');
    }
    
    function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    }
    
    function handleDrop(e) {
        e.preventDefault();
        const draggedElement = document.querySelector('.dragging');
        if (draggedElement) {
            this.appendChild(draggedElement);
            updateTaskCounts();
        }
    }
    
    // Função para inicializar busca
    function initializeSearch() {
        const searchInput = document.getElementById('userSearch');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const userCards = document.querySelectorAll('.user-card');
                
                userCards.forEach(card => {
                    const userName = card.querySelector('h4').textContent.toLowerCase();
                    const userEmail = card.querySelector('p').textContent.toLowerCase();
                    
                    if (userName.includes(searchTerm) || userEmail.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }
    }
    
    // Função para inicializar modais
    function initializeModals() {
        // Fechar modais ao clicar no X ou fora do modal
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('close') || e.target.classList.contains('modal')) {
                const modal = e.target.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }
        });
    }
    
    // Função para atualizar contadores de tarefas
    function updateTaskCounts() {
        document.querySelectorAll('.kanban-column').forEach(column => {
            const taskCount = column.querySelectorAll('.kanban-card').length;
            const countElement = column.querySelector('.task-count');
            if (countElement) {
                countElement.textContent = taskCount;
            }
        });
    }
    
    // Função para inicializar chat
    function initializeChat() {
        // Implementação básica do chat
        console.log('Chat inicializado');
    }
    
    // Função para inicializar modal de edição
    function initializeEditTaskModal() {
        // Implementação básica do modal de edição
        console.log('Modal de edição inicializado');
    }
    
    // Função para inicializar admin chat
    function initializeAdminChat() {
        // Implementação básica do admin chat
        console.log('Admin chat inicializado');
    }
    </script>
</body>
</html> 